# Набор инструментов для формата P3

Каталог содержит Python‑скрипты для конвертации и воспроизведения аудио в формате P3.

## 1. Конвертер аудио → P3 (`convert_audio_to_p3.py`)

Преобразует обычный аудиофайл в формат P3 (поток из заголовков по 4 байта и Opus‑пакетов) и выполняет нормализацию громкости.

### Использование

```bash
python convert_audio_to_p3.py <входной_файл> <выходной_p3> [-l LUFS] [-d]
```

- `-l` — целевой уровень громкости, по умолчанию −16 LUFS.
- `-d` — отключить нормализацию громкости.

Рекомендуется добавлять `-d`, если:
- трек очень короткий;
- громкость уже откалибрована;
- источник — стандартный TTS Xiaozhi (он уже −16 LUFS).

Пример:
```bash
python convert_audio_to_p3.py input.mp3 output.p3
```

## 2. Проигрыватель P3 (`play_p3.py`)

Декодирует и воспроизводит файлы P3.

### Возможности

- Воспроизведение P3‑файлов
- Плавное затухание при остановке или прерывании
- Выбор файла через аргументы командной строки

### Использование

```bash
python play_p3.py <файл.p3>
```

Пример:
```bash
python play_p3.py output.p3
```

## 3. Конвертер P3 → аудио (`convert_p3_to_audio.py`)

Преобразует P3 обратно в обычный аудиофайл.

### Использование

```bash
python convert_p3_to_audio.py <вход.p3> <выходной_файл>
```

У выходного файла должно быть расширение.

Пример:
```bash
python convert_p3_to_audio.py input.p3 output.wav
```

## 4. Графический пакетный конвертер

GUI‑утилита для массовой конвертации аудио ↔ P3.

![](./img/img.png)

Запуск:
```bash
python batch_convert_gui.py
```

## Зависимости

Перед работой установите библиотеки:

```bash
pip install librosa opuslib numpy tqdm sounddevice pyloudnorm soundfile
```

или используйте `requirements.txt`:

```bash
pip install -r requirements.txt
```

## Формат P3

- Каждый кадр состоит из 4‑байтового заголовка и Opus‑пакета.
- Заголовок: [1 байт типа, 1 байт резерва, 2 байта длины].
- Частота 16000 Гц, моно.
- Длительность кадра 60 мс.
